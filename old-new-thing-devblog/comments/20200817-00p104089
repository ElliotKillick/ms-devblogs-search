Alexis Ryan  August 20, 2020


  0  Collapse this comment
Copy link
The low bits of the pointer always being 0 and only the top bit being used as the flag also means that doing a left shit of 1 bit will recover the usable pointer as it will shift out the top bit and shift in the last 0 to the bottom.
On a 64 bit platform using a 64 bit refcount would seem strange. But doesn’t really matter it is just internal implementation details.





Rand Random  August 17, 2020


  0  Collapse this comment
Copy link
Just in case you don’t know it there are more tags than just simply „Code“.
Every post you have written as long as I can remember you have used only the tag „Code“.





word merchant  August 19, 2020


  0  Collapse this comment
Copy link
But that’s a good thing. When I have a desperate need* to know what the Kardashians are up to, I look elsewhere.
(* this doesn’t happen often.)





Raymond Chen Author
August 17, 2020


  0  Collapse this comment
Copy link
I have only six categories: Code, History, Tips/Support, Other, Non-Computer, and Microspeak. (And Microspeak is really a subcategory.) This blog is 90% code.





Henke37  August 18, 2020


  0  Collapse this comment
Copy link
Could use an “airtight hatchway” category, since that’s a reoccurring topic.




Doug Deden  August 17, 2020


  0  Collapse this comment
Copy link
Yes, Raymond has been on a bit of a code kick lately. But you must not be able to remember very long, because just six days ago there was a post tagged “Microspeak” and “Other”. And “History” on 28 July 2020. And another “Other” on 30 June 2020.




Joshua Hudson  August 17, 2020


  0  Collapse this comment
Copy link
I should send this trick to the C# guy just to listen to him scream in horror.





Sunil Joshi  August 17, 2020


  0  Collapse this comment
Copy link
IIRC, the .NET framework / .NET core uses a similar technique in its object headers.





IS4  August 18, 2020


  0  Collapse this comment
Copy link
Do you mean the sync block?





Sunil Joshi  August 18, 2020


  0  Collapse this comment
Copy link
Yes. I believe NT Kernel Objects do so as well.